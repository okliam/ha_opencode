---
name: "HA OpenCode"
description: "AI coding agent for editing Home Assistant configuration with deep MCP integration and LSP support"
version: "1.2.5"
slug: "ha_opencode"
# image: "ghcr.io/magnusoverli/ha_opencode/{arch}"
url: "https://github.com/okliam/ha_opencode"
arch:
  - aarch64
  - amd64
startup: application
init: false

# Ingress configuration
ingress: true
ingress_port: 8099
ingress_stream: true
panel_icon: mdi:robot
panel_title: HA OpenCode

# Direct access port for OpenCode Web UI
ports:
  4096/tcp: 4096
ports_description:
  4096/tcp: "OpenCode Web UI (direct access with full clipboard support)"

# File access - Home Assistant config directory
map:
  - type: homeassistant_config
    read_only: false

# API access - needed for logs
hassio_api: true
hassio_role: default
homeassistant_api: true

# Security - keep permissions minimal
host_network: false
privileged: []
apparmor: true

# User-configurable options
options:
  # Feature toggles
  mcp_enabled: false
  lsp_enabled: true
  
  # Custom MCP servers configuration
  mcp_custom_servers: []
  
  # CPU mode: auto (detect), baseline (for older CPUs), regular (force AVX2)
  cpu_mode: "auto"
  
  # Terminal appearance
  terminal_theme: "breeze"
  font_size: 14
  cursor_style: "block"
  cursor_blink: false
  
  # Advanced: custom OpenCode configuration (JSON)
  opencode_config: ""
  
  # OpenCode Web UI (direct access with clipboard support)
  webui_enabled: true
  webui_password: ""
  webui_log_level: "INFO"
  webui_mdns: false

schema:
  # Feature toggles
  mcp_enabled: bool
  lsp_enabled: bool
  
  # Custom MCP servers
  mcp_custom_servers:
    type: list
    schema:
      name: str
      type: list(stdio|sse)
      command: str?
      args: list(str)?
      url: str?
      env: dict?
      proxy: str?
  
  # CPU mode
  cpu_mode: list(auto|baseline|regular)
  
  # Terminal appearance
  terminal_theme: list(breeze|catppuccin_mocha|catppuccin_latte|dracula|nord|tokyo_night|one_dark|solarized_dark|solarized_light|gruvbox_dark)
  font_size: int(10,24)
  cursor_style: list(block|underline|bar)
  cursor_blink: bool
  
  # Advanced
  opencode_config: str?
  
  # OpenCode Web UI
  webui_enabled: bool
  webui_password: str?
  webui_log_level: list(DEBUG|INFO|WARN|ERROR)
  webui_mdns: bool

# Exclude caches from backups
backup_exclude:
  - ".npm/*"
  - ".cache/*"
  - ".local/share/opencode/cache/*"
